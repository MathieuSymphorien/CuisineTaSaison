<div class="modal-overlay" (click)="close()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="close()">✕</button>

        @if (!isEditing()) {
        <!-- Mode lecture -->
        <div class="recipe-header">
            <h2>{{ recipe()?.name }}</h2>
        </div>

        <p class="description">{{ recipe()?.description }}</p>

        <div class="meta-grid">
            <div class="meta-item">
                <span class="meta-label">Temps de préparation</span>
                <span class="meta-value"
                    >{{ recipe()?.preparationTime }} min</span
                >
                <span class="meta-label">Temps de cuisson</span>
                <span class="meta-value">{{ recipe()?.bakeTime }} min</span>
                <span class="meta-label">Temps de repos</span>
                <span class="meta-value">{{ recipe()?.restTime }} min</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Personnes</span>
                <span class="meta-value">{{ recipe()?.people }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Four</span>
                <span class="meta-value"
                    >{{ recipe()?.oven ? 'Oui ✅' : 'Non ❌' }}</span
                >
            </div>
        </div>

        <div class="section">
            <h3>Ingrédients</h3>
            <ul class="ingredients-list">
                @for (food of recipe()?.foods; track food.id) {
                <li>{{ food.name }}</li>
                }
            </ul>
        </div>

        <div class="section">
            <h3>Étapes de préparation</h3>
            <ol class="steps-list">
                @for (step of recipe()?.steps; track $index) {
                <li>{{ step }}</li>
                }
            </ol>
        </div>

        @if (isAdmin()) {
        <div class="admin-actions">
            <button class="btn btn-primary" (click)="toggleEdit()">
                Modifier
            </button>
        </div>
        } } @else {
        <!-- Mode édition -->
        <div class="edit-form">
            <h2>Modifier la recette</h2>

            <div class="form-group">
                <label>Nom</label>
                <input
                    type="text"
                    [ngModel]="name()"
                    (ngModelChange)="name.set($event)"
                />
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea
                    [ngModel]="description()"
                    (ngModelChange)="description.set($event)"
                    rows="3"
                ></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Temps (min)</label>
                    <input
                        type="number"
                        [ngModel]="preparationTime()"
                        (ngModelChange)="preparationTime.set($event)"
                    />
                    <input
                        type="number"
                        [ngModel]="bakeTime()"
                        (ngModelChange)="bakeTime.set($event)"
                    />
                    <input
                        type="number"
                        [ngModel]="restTime()"
                        (ngModelChange)="restTime.set($event)"
                    />
                </div>

                <div class="form-group">
                    <label>Personnes</label>
                    <input
                        type="number"
                        [ngModel]="people()"
                        (ngModelChange)="people.set($event)"
                    />
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input
                            type="checkbox"
                            [ngModel]="oven()"
                            (ngModelChange)="oven.set($event)"
                        />
                        Four nécessaire
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label>Étapes (une par ligne)</label>
                <textarea
                    [ngModel]="stepsText()"
                    (ngModelChange)="stepsText.set($event)"
                    rows="6"
                ></textarea>
            </div>

            <div class="edit-actions">
                <button
                    class="btn btn-secondary"
                    (click)="toggleEdit()"
                    [disabled]="isSaving()"
                >
                    Annuler
                </button>
                <button
                    class="btn btn-primary"
                    (click)="save()"
                    [disabled]="isSaving()"
                >
                    @if (isSaving()) { Enregistrement... } @else { Enregistrer }
                </button>
            </div>
        </div>
        }
    </div>
</div>
